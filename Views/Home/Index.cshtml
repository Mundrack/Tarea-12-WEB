@model HomeViewModel;

@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <h1 class="display-4">Gestión de Vehículos 🚗</h1>
    <p>Sistema de administración de vehículos Ford con <strong>patrones de diseño</strong></p>

    @* Mostrar mensaje de error si existe *@
    @if (!string.IsNullOrEmpty(ViewBag.ErrorMessage))
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <strong>⚠️ Error:</strong> @ViewBag.ErrorMessage
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    }

    @* Botones para agregar vehículos - MEJORA: Se agregó el botón para Ford Escape *@
    <div class="mb-4">
        <h3>Agregar Vehículos</h3>
        <div class="btn-group" role="group">
            <a href="/Home/AddMustang" class="btn btn-danger btn-lg">
                <strong>🏎️ Agregar Mustang</strong>
                <br><small>Deportivo • Rojo • Manual</small>
            </a>
            <a href="/Home/AddExplorer" class="btn btn-dark btn-lg">
                <strong>🚙 Agregar Explorer</strong>
                <br><small>SUV • Negro • 4WD</small>
            </a>
            <!-- NUEVO: Botón para agregar Ford Escape -->
            <a href="/Home/AddEscape" class="btn btn-primary btn-lg">
                <strong>🚗 Agregar Escape</strong>
                <br><small>SUV Compacto • Rojo • FWD</small>
            </a>
        </div>
    </div>

    @* Tabla de vehículos - MEJORA: Se agregó la columna Year *@
    <h3>Vehículos Registrados (@Model.Vehicles.Count)</h3>

    @if (Model.Vehicles.Count == 0)
    {
        <div class="alert alert-info">
            <strong>ℹ️ No hay vehículos registrados.</strong> Usa los botones de arriba para agregar vehículos.
        </div>
    }
    else
    {
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="thead-dark">
                    <tr>
                        <th>ID</th>
                        <th>Tipo</th>
                        <th>Marca</th>
                        <th>Modelo</th>
                        <th>Año</th> <!-- NUEVA COLUMNA -->
                        <th>Color</th>
                        <th>Combustible</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var vehicle in Model.Vehicles)
                    {
                        <tr>
                            <td><small>@vehicle.ID.ToString().Substring(0, 8)...</small></td>
                            <td>
                                @if (vehicle.GetType().Name == "Car")
                                {
                                    <span class="badge badge-info">🚗 Auto</span>
                                }
                                else
                                {
                                    <span class="badge badge-warning">🏍️ Moto</span>
                                }
                            </td>
                            <td><strong>@vehicle.Brand</strong></td>
                            <td>@vehicle.Model</td>
                            <td><strong>@vehicle.Year</strong></td> <!-- MOSTRAR AÑO -->
                            <td>
                                <span class="badge" style="background-color: @vehicle.Color.ToLower(); color: white;">
                                    @vehicle.Color
                                </span>
                            </td>
                            <td>
                                <div class="progress" style="height: 25px;">
                                    @{
                                        var gasPercentage = (vehicle.Gas / vehicle.FuelLimit) * 100;
                                        var progressClass = gasPercentage > 50 ? "bg-success" : gasPercentage > 20 ? "bg-warning" : "bg-danger";
                                    }
                                    <div class="progress-bar @progressClass" role="progressbar"
                                         style="width: @gasPercentage%"
                                         aria-valuenow="@vehicle.Gas"
                                         aria-valuemin="0"
                                         aria-valuemax="@vehicle.FuelLimit">
                                        @vehicle.Gas.ToString("N1") / @vehicle.FuelLimit
                                    </div>
                                </div>
                            </td>
                            <td>
                                @if (vehicle.IsEngineOn())
                                {
                                    <span class="badge badge-success">🔥 Encendido</span>
                                }
                                else
                                {
                                    <span class="badge badge-secondary">🛑 Apagado</span>
                                }
                            </td>
                            <td>
                                @if (vehicle.IsEngineOn())
                                {
                                    <a href="/Home/StopEngine?id=@vehicle.ID" class="btn btn-sm btn-warning">
                                        🛑 Apagar
                                    </a>
                                }
                                else
                                {
                                    <a href="/Home/StartEngine?id=@vehicle.ID" class="btn btn-sm btn-success">
                                        🔥 Encender
                                    </a>
                                }

                                <a href="/Home/AddGas?id=@vehicle.ID" class="btn btn-sm btn-info">
                                    ⛽ Llenar
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }

    <hr>
    <p class="text-muted">
        <small>
            <strong>💡 Patrones implementados:</strong>
            Factory Method • Builder • Singleton • Strategy • Dependency Injection
        </small>
    </p>
</div>